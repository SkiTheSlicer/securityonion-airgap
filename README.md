#SecurityOnion-AirGap
##Purpose
This project is meant to address managing a [Security Onion](https://security-onion-solutions.github.io/security-onion/) deployment inside an air-gapped network.
##Considerations
1. [Snort](https://snort.org/)
  - Snort rule updates. Security Onion comes ships with an old ruleset from Emerging Threats. It is meant to be updated during sosetup and then by cron job.
  - Using other rulesets. When the Security Onion IDS is configured in offline mode, rule-update only looks for the emergingthreats ruleset.
2. [SQueRT](http://www.squertproject.org/)
  - ip2c updates. SQueRT only recognizes RFC1918 addressed by default. When sosetup is run, updates are pulled from the Regional Internet Registries and added to the securityonion_db.ip2c MySQL table. It is then updated by cron job.
3. [Bro](https://www.bro.org/)
  - GeoIP updates. Bro relies on GeoIP data files to assign country codes to its log entries. Security Onion ships with old versions of GeoIP.dat and GeoIPv6.dat. It does not have GeoIPCity.dat.
4. [Ubuntu](http://www.ubuntu.com/)
  - This should be an obvious consideration, but I will not be addressing it at this time. It is updated by apt-get/soup.
##Components
*Scripts were written in [Python 2.7.6](https://www.python.org/download/releases/2.7.6/)*
*Initial development was under Security Onion 12.04.5.3 and continued under 14.04.3.1*
1. Online Downloader (securityonion-airgap-download.py)
  - Requires [BeautifulSoup4](http://www.crummy.com/software/BeautifulSoup/bs4/download/) Python library.
  - Requires [requests](http://docs.python-requests.org/en/latest/user/install/#install) Python library (already included in Security Onion 14)
2. Offline Updater (securityonion-airgap-update.py)
  1. SQueRT Updater (squert-ip2c-update.py). Requires MySQL root, not OS root. Master server only.
    - Requires [mysql.connector](https://dev.mysql.com/downloads/connector/python/) Python library.
  2. Snort & Bro Updater (ids-offline-update.py). Requires OS root. Stort rules on Master server, GeoIP files on Master and Sensors.
##Example Download
$ python securityonion-airgap-download.py -e \*\*\*\*\*@\*\*\*\*\*.com
*Email address has been sanitized.*
```
Output Dir: so-airgap-20160109-1757

[GeoIP]
Downloading GeoIP.dat.gz...
Decompressing GeoIP.dat.gz...
Downloading GeoIPv6.dat.gz...
Decompressing GeoIPv6.dat.gz...
Downloading GeoLiteCity.dat.gz...
Decompressing GeoLiteCity.dat.gz...
Downloading GeoLiteCityv6.dat.gz...
Decompressing GeoLiteCityv6.dat.gz...

[RIR]
Downloading delegated-afrinic-extended-latest...
Downloading delegated-afrinic-extended-latest.md5...
Downloading delegated-apnic-extended-latest...
Downloading delegated-apnic-extended-latest.md5...
Downloading delegated-arin-extended-latest...
Downloading delegated-arin-extended-latest.md5...
Downloading delegated-lacnic-extended-latest...
Downloading delegated-lacnic-extended-latest.md5...
Downloading delegated-ripencc-extended-latest...
Downloading delegated-ripencc-extended-latest.md5...
Checking MD5 for delegated-afrinic-extended-latest...
  MD5 OK
Checking MD5 for delegated-apnic-extended-latest...
  MD5 OK
Checking MD5 for delegated-arin-extended-latest...
  MD5 OK
Checking MD5 for delegated-lacnic-extended-latest...
  MD5 OK
Checking MD5 for delegated-ripencc-extended-latest...
  MD5 OK

[Snort Static]
Downloading community-rules.tar.gz...
Downloading md5s...
Downloading ip-filter.blf...
Downloading compromised-ips.txt...
Checking MD5 for community-rules.tar.gz...
  MD5 OK

[Snort ET Dynamic]
Downloading emerging.rules.tar.gz...
Downloading emerging.rules.tar.gz.md5...
Checking MD5 for emerging.rules.tar.gz...
  MD5 OK
Downloading emerging.rules.tar.gz...
Downloading emerging.rules.tar.gz.md5...
Checking MD5 for emerging.rules.tar.gz...
  MD5 OK

[Snort VRT Dynamic]
Snort.org E-mail: *****@*****.com
Password: 
Signed in successfully.
Downloading snortrules-snapshot-2962.tar.gz...
Downloading snortrules-snapshot-2976.tar.gz...
Downloading snortrules-snapshot-2980.tar.gz...
Downloading md5s...
Checking MD5 for snortrules-snapshot-2962.tar.gz...
  MD5 OK
Checking MD5 for snortrules-snapshot-2976.tar.gz...
  MD5 OK
Checking MD5 for snortrules-snapshot-2980.tar.gz...
  MD5 OK

[Final]
Compressing so-airgap-20160109-1757...
  MD5: be1581f3c9f58402978d1a2968624c88
```
$ du -ch so-airgap-20160109-1757
```
40M	so-airgap-20160109-1757/GeoIP
20M	so-airgap-20160109-1757/RIR
384K	so-airgap-20160109-1757/Snort/VRT_Community
448K	so-airgap-20160109-1757/Snort/Blacklist
1.9M	so-airgap-20160109-1757/Snort/ET_GPL
1.8M	so-airgap-20160109-1757/Snort/ET_NonGPL
101M	so-airgap-20160109-1757/Snort/VRT_Registered
106M	so-airgap-20160109-1757/Snort
165M	so-airgap-20160109-1757
165M	total
```
$ ls -lh so-airgap-20160109-1757.\*
```
-rw-r--r-- 1 skitheslicer skitheslicer 131M Jan  9 18:02 so-airgap-20160109-1757.tar.gz
-rw-r--r-- 1 skitheslicer skitheslicer   63 Jan  9 18:02 so-airgap-20160109-1757.tar.gz.md5
```
